var ngMap=angular.module("ngMap",[]);ngMap.service("Attr2Options",["$parse","NavigatorGeolocation","GeoCoder",function($parse,NavigatorGeolocation,GeoCoder){var SPECIAL_CHARS_REGEXP=/([\:\-\_]+(.))/g,MOZ_HACK_REGEXP=/^moz([A-Z])/,orgAttributes=function(e){e.length>0&&(e=e[0]);for(var t={},n=0;n<e.attributes.length;n++){var r=e.attributes[n];t[r.name]=r.value}return t},camelCase=function(e){return e.replace(SPECIAL_CHARS_REGEXP,function(e,t,n,r){return r?n.toUpperCase():n}).replace(MOZ_HACK_REGEXP,"Moz$1")},JSONize=function(e){try{return JSON.parse(e),e}catch(t){return e.replace(/([\$\w]+)\s*:/g,function(e,t){return'"'+t+'":'}).replace(/'([^']+)'/g,function(e,t){return'"'+t+'"'})}},toOptionValue=function(input,options){var output,key=options.key,scope=options.scope;try{var num=Number(input);if(isNaN(num))throw"Not a number";output=num}catch(err){try{if(input.match(/^[\+\-]?[0-9\.]+,[ ]*\ ?[\+\-]?[0-9\.]+$/)&&(input="["+input+"]"),output=JSON.parse(JSONize(input)),output instanceof Array){var t1stEl=output[0];if(t1stEl.constructor==Object);else if(t1stEl.constructor==Array)output=output.map(function(e){return new google.maps.LatLng(e[0],e[1])});else if(!isNaN(parseFloat(t1stEl))&&isFinite(t1stEl))return new google.maps.LatLng(output[0],output[1])}}catch(err2){if(input.match(/^[A-Z][a-zA-Z0-9]+\(.*\)$/))try{var exp="new google.maps."+input;output=eval(exp)}catch(e){output=input}else if(input.match(/^([A-Z][a-zA-Z0-9]+)\.([A-Z]+)$/))try{var matches=input.match(/^([A-Z][a-zA-Z0-9]+)\.([A-Z]+)$/);output=google.maps[matches[1]][matches[2]]}catch(e){output=input}else if(input.match(/^[A-Z]+$/))try{var capitalizedKey=key.charAt(0).toUpperCase()+key.slice(1);key.match(/temperatureUnit|windSpeedUnit|labelColor/)?(capitalizedKey=capitalizedKey.replace(/s$/,""),output=google.maps.weather[capitalizedKey][input]):output=google.maps[capitalizedKey][input]}catch(e){output=input}else output=input}}return output},setDelayedGeoLocation=function(e,t,n,r){r=r||{};var o=e.centered||r.centered,a=function(){var n=r.fallbackLocation||new google.maps.LatLng(0,0);e[t](n)};!n||n.match(/^current/i)?NavigatorGeolocation.getCurrentPosition().then(function(n){var r=n.coords.latitude,a=n.coords.longitude,i=new google.maps.LatLng(r,a);e[t](i),o&&e.map.setCenter(i)},a):GeoCoder.geocode({address:n}).then(function(n){e[t](n[0].geometry.location),o&&e.map.setCenter(n[0].geometry.location)},a)},getAttrsToObserve=function(e){var t=[];if(e["ng-repeat"]||e.ngRepeat);else for(var n in e){var r=e[n];r&&r.match(/\{\{.*\}\}/)&&t.push(camelCase(n))}return t},observeAttrSetObj=function(e,t,n){var r=getAttrsToObserve(e);Object.keys(r).length;for(var o=0;o<r.length;o++)observeAndSet(t,r[o],n)},observeAndSet=function(e,t,n){e.$observe(t,function(e){if(e){var r=camelCase("set-"+t),o=toOptionValue(e,{key:t});n[r]&&(t.match(/center|position/)&&"string"==typeof o?setDelayedGeoLocation(n,r,o):n[r](o))}})};return{filter:function(e){var t={};for(var n in e)n.match(/^\$/)||n.match(/^ng[A-Z]/)||(t[n]=e[n]);return t},getOptions:function(e,t){var n={};for(var r in e)if(e[r]){if(r.match(/^on[A-Z]/))continue;if(r.match(/ControlOptions$/))continue;n[r]=toOptionValue(e[r],{scope:t,key:r})}return n},getEvents:function(e,t){var n={},r=function(e){return"_"+e.toLowerCase()},o=function(t){var n=t.match(/([^\(]+)\(([^\)]*)\)/),r=n[1],o=n[2].replace(/event[ ,]*/,""),a=e.$eval("["+o+"]");return function(t){e[r].apply(this,[t].concat(a)),e.$apply()}};for(var a in t)if(t[a]){if(!a.match(/^on[A-Z]/))continue;var i=a.replace(/^on/,"");i=i.charAt(0).toLowerCase()+i.slice(1),i=i.replace(/([A-Z])/g,r);var s=t[a];n[i]=new o(s)}return n},getControlOptions:function(e){var t={};if("object"!=typeof e)return!1;for(var n in e)if(e[n]){if(!n.match(/(.*)ControlOptions$/))continue;var r=e[n],o=r.replace(/'/g,'"');o=o.replace(/([^"]+)|("[^"]+")/g,function(e,t,n){return t?t.replace(/([a-zA-Z0-9]+?):/g,'"$1":'):n});try{var a=JSON.parse(o);for(var i in a)if(a[i]){var s=a[i];if("string"==typeof s?s=s.toUpperCase():"mapTypeIds"===i&&(s=s.map(function(e){return e.match(/^[A-Z]+$/)?google.maps.MapTypeId[e.toUpperCase()]:e})),"style"===i){var p=n.charAt(0).toUpperCase()+n.slice(1),c=p.replace(/Options$/,"")+"Style";a[i]=google.maps[c][s]}else a[i]="position"===i?google.maps.ControlPosition[s]:s}t[n]=a}catch(l){}}return t},toOptionValue:toOptionValue,camelCase:camelCase,setDelayedGeoLocation:setDelayedGeoLocation,getAttrsToObserve:getAttrsToObserve,observeAndSet:observeAndSet,observeAttrSetObj:observeAttrSetObj,orgAttributes:orgAttributes}}]),ngMap.service("GeoCoder",["$q",function(e){return{geocode:function(t){var n=e.defer(),r=new google.maps.Geocoder;return r.geocode(t,function(e,t){t==google.maps.GeocoderStatus.OK?n.resolve(e):n.reject("Geocoder failed due to: "+t)}),n.promise}}}]),ngMap.service("NavigatorGeolocation",["$q",function(e){return{getCurrentPosition:function(){var t=e.defer();return navigator.geolocation?navigator.geolocation.getCurrentPosition(function(e){t.resolve(e)},function(e){t.reject(e)}):t.reject("Browser Geolocation service failed."),t.promise},watchPosition:function(){return"TODO"},clearWatch:function(){return"TODO"}}}]),ngMap.service("StreetView",["$q",function(e){return{getPanorama:function(t,n){n=n||t.getCenter();var r=e.defer(),o=new google.maps.StreetViewService;return o.getPanoramaByLocation(n||t.getCenter,100,function(e,t){t===google.maps.StreetViewStatus.OK?r.resolve(e.location.pano):r.resolve(!1)}),r.promise},setPanorama:function(e,t){var n=new google.maps.StreetViewPanorama(e.getDiv(),{enableCloseButton:!0});n.setPano(t)}}}]),ngMap.directive("bicyclingLayer",["Attr2Options",function(e){var t=e,n=function(e,t){var n=new google.maps.BicyclingLayer(e);for(var r in t)google.maps.event.addListener(n,r,t[r]);return n};return{restrict:"E",require:"^map",link:function(e,r,o,a){var i=t.orgAttributes(r),s=t.filter(o),p=t.getOptions(s),c=t.getEvents(e,s),l=n(p,c);a.addObject("bicyclingLayers",l),t.observeAttrSetObj(i,o,l)}}}]),ngMap.directive("cloudLayer",["Attr2Options",function(e){var t=e,n=function(e,t){var n=new google.maps.weather.CloudLayer(e);for(var r in t)google.maps.event.addListener(n,r,t[r]);return n};return{restrict:"E",require:"^map",link:function(e,r,o,a){var i=t.orgAttributes(r),s=t.filter(o),p=t.getOptions(s),c=t.getEvents(e,s),l=n(p,c);a.addObject("cloudLayers",l),t.observeAttrSetObj(i,o,l)}}}]),ngMap.directive("customControl",["Attr2Options","$compile",function(e,t){var n=e;return{restrict:"E",require:"^map",link:function(e,r,o,a){r.css("display","none");var i=(n.orgAttributes(r),n.filter(o)),s=n.getOptions(i,e),p=n.getEvents(e,i),c=t(r.html().trim())(e),l=c[0];for(var u in p)google.maps.event.addDomListener(l,u,p[u]);a.addObject("customControls",l),e.$on("mapInitialized",function(e,t){var n=s.position;t.controls[google.maps.ControlPosition[n]].push(l)})}}}]),ngMap.directive("dynamicMapsEngineLayer",["Attr2Options",function(e){var t=e,n=function(e,t){var n=new google.maps.visualization.DynamicMapsEngineLayer(e);for(var r in t)google.maps.event.addListener(n,r,t[r]);return n};return{restrict:"E",require:"^map",link:function(e,r,o,a){var i=t.filter(o),s=t.getOptions(i),p=t.getEvents(e,i,p),c=n(s,p);a.addObject("mapsEngineLayers",c)}}}]),ngMap.directive("fusionTablesLayer",["Attr2Options",function(e){var t=e,n=function(e,t){var n=new google.maps.FusionTablesLayer(e);for(var r in t)google.maps.event.addListener(n,r,t[r]);return n};return{restrict:"E",require:"^map",link:function(e,r,o,a){var i=t.filter(o),s=t.getOptions(i),p=t.getEvents(e,i,p),c=n(s,p);a.addObject("fusionTablesLayers",c)}}}]),ngMap.directive("heatmapLayer",["Attr2Options","$window",function(e,t){var n=e;return{restrict:"E",require:"^map",link:function(e,r,o,a){var i=n.filter(o),s=n.getOptions(i);if(s.data=t[o.data]||e[o.data],!(s.data instanceof Array))throw"invalid heatmap data";s.data=new google.maps.MVCArray(s.data);{var p=new google.maps.visualization.HeatmapLayer(s);n.getEvents(e,i)}a.addObject("heatmapLayers",p)}}}]),ngMap.directive("infoWindow",["Attr2Options","$compile","$timeout",function(e,t,n){var r=e,o=function(e,n,o){var a;if(!e.position||e.position instanceof google.maps.LatLng)a=new google.maps.InfoWindow(e);else{var i=e.position;e.position=new google.maps.LatLng(0,0),a=new google.maps.InfoWindow(e),r.setDelayedGeoLocation(a,"setPosition",i)}Object.keys(n).length>0;for(var s in n)s&&google.maps.event.addListener(a,s,n[s]);var p=o.html().trim();if(1!=angular.element(p).length)throw"info-window working as a template must have a container";return a.__template=p.replace(/\s?ng-non-bindable[='"]+/,""),a.__compile=function(e){var n=t(a.__template)(e);e.$apply(),a.setContent(n.html())},a};return{restrict:"E",require:"^map",link:function(e,t,a,i){t.css("display","none");var s=r.orgAttributes(t),p=r.filter(a),c=r.getOptions(p,e),l=r.getEvents(e,p),u=o(c,l,t);if(i.addObject("infoWindows",u),r.observeAttrSetObj(s,a,u),u.visible){if(!u.position)throw"Invalid position";e.$on("mapInitialized",function(t,r){n(function(){u.__compile(e),u.open(r)})})}u.visibleOnMarker&&e.$on("mapInitialized",function(t,r){n(function(){var t=u.visibleOnMarker,n=r.markers[t];if(!n)throw"Invalid marker id";u.__compile(e),u.open(r,n)})}),e.showInfoWindow=e.showInfoWindow||function(t,n,r){var o=i.map.infoWindows[n];o.__compile(e),r?o.open(i.map,r):this.getPosition?o.open(i.map,this):o.open(i.map)}}}}]),ngMap.directive("kmlLayer",["Attr2Options",function(e){var t=e,n=function(e,t){var n=new google.maps.KmlLayer(e);for(var r in t)google.maps.event.addListener(n,r,t[r]);return n};return{restrict:"E",require:"^map",link:function(e,r,o,a){var i=t.orgAttributes(r),s=t.filter(o),p=t.getOptions(s),c=t.getEvents(e,s),l=n(p,c);a.addObject("kmlLayers",l),t.observeAttrSetObj(i,o,l)}}}]),ngMap.directive("mapData",["Attr2Options",function(e){var t=e;return{restrict:"E",require:"^map",link:function(e,n,r){var o=t.filter(r),a=t.getOptions(o),i=t.getEvents(e,o,i);e.$on("mapInitialized",function(t,n){for(var r in a)if(r){var o=a[r];"function"==typeof e[o]?n.data[r](e[o]):n.data[r](o)}for(var s in i)i[s]&&n.data.addListener(s,i[s])})}}}]),ngMap.directive("mapType",["Attr2Options","$window",function(e,t){return{restrict:"E",require:"^map",link:function(e,n,r,o){var a,i=r.name;if(!i)throw"invalid map-type name";if(r.object){var s=e[r.object]?e:t;a=s[r.object],"function"==typeof a&&(a=new a)}if(!a)throw"invalid map-type object";e.$on("mapInitialized",function(e,t){t.mapTypes.set(i,a)}),o.addObject("mapTypes",a)}}}]),ngMap.directive("map",["Attr2Options","$timeout",function(e,t){function n(e,t){if(e.currentStyle)var n=e.currentStyle[t];else if(window.getComputedStyle)var n=document.defaultView.getComputedStyle(e,null).getPropertyValue(t);return n}var r=e;return{restrict:"AE",controller:ngMap.MapController,link:function(o,a,i,s){var p=r.orgAttributes(a);o.google=google;var c=document.createElement("div");c.style.width="100%",c.style.height="100%",a.prepend(c),"block"!=n(a[0],"display")&&a.css("display","block"),n(a[0],"height").match(/^0/)&&a.css("height","300px");var l=function(n,a){var l=new google.maps.Map(c,{});l.markers={},l.shapes={},t(function(){google.maps.event.trigger(l,"resize")}),n.zoom=n.zoom||15;var u=n.center;u instanceof google.maps.LatLng||(delete n.center,e.setDelayedGeoLocation(l,"setCenter",u,g.geoFallbackCenter)),l.setOptions(n);for(var m in a)m&&google.maps.event.addListener(l,m,a[m]);r.observeAttrSetObj(p,i,l),s.map=l,s.addObjects(s._objects),o.map=l,o.map.scope=o,o.$emit("mapInitialized",l),o.maps=o.maps||{},o.maps[g.id||Object.keys(o.maps).length]=l,o.$emit("mapsInitialized",o.maps)},u=r.filter(i),g=r.getOptions(u,o),m=r.getControlOptions(u),v=angular.extend(g,m),f=r.getEvents(o,u);i.initEvent?o.$on(i.initEvent,function(){!s.map&&l(v,f)}):l(v,f)}}}]),ngMap.MapController=function(){this.map=null,this._objects=[],this.addMarker=function(e){if(this.map){this.map.markers=this.map.markers||{},e.setMap(this.map),e.centered&&this.map.setCenter(e.position);var t=Object.keys(this.map.markers).length;this.map.markers[e.id||t]=e}else this._objects.push(e)},this.addShape=function(e){if(this.map){this.map.shapes=this.map.shapes||{},e.setMap(this.map);var t=Object.keys(this.map.shapes).length;this.map.shapes[e.id||t]=e}else this._objects.push(e)},this.addObject=function(e,t){if(this.map){this.map[e]=this.map[e]||{};var n=Object.keys(this.map[e]).length;this.map[e][t.id||n]=t,"infoWindows"!=e&&t.setMap&&t.setMap(this.map)}else t.groupName=e,this._objects.push(t)},this.addObjects=function(e){for(var t=0;t<e.length;t++){var n=e[t];n instanceof google.maps.Marker?this.addMarker(n):n instanceof google.maps.Circle||n instanceof google.maps.Polygon||n instanceof google.maps.Polyline||n instanceof google.maps.Rectangle||n instanceof google.maps.GroundOverlay?this.addShape(n):this.addObject(n.groupName,n)}}},ngMap.directive("mapsEngineLayer",["Attr2Options",function(e){var t=e,n=function(e,t){var n=new google.maps.visualization.MapsEngineLayer(e);for(var r in t)google.maps.event.addListener(n,r,t[r]);return n};return{restrict:"E",require:"^map",link:function(e,r,o,a){var i=t.filter(o),s=t.getOptions(i),p=t.getEvents(e,i,p),c=n(s,p);a.addObject("mapsEngineLayers",c)}}}]),ngMap.directive("marker",["Attr2Options",function(e){var t=e,n=function(e,n){var r;if(e.icon instanceof Object){(""+e.icon.path).match(/^[A-Z_]+$/)&&(e.icon.path=google.maps.SymbolPath[e.icon.path]);for(var o in e.icon){var a=e.icon[o];"anchor"==o||"origin"==o?e.icon[o]=new google.maps.Point(a[0],a[1]):("size"==o||"scaledSize"==o)&&(e.icon[o]=new google.maps.Size(a[0],a[1]))}}if(e.position instanceof google.maps.LatLng)r=new google.maps.Marker(e);else{var i=e.position;e.position=new google.maps.LatLng(0,0),r=new google.maps.Marker(e),t.setDelayedGeoLocation(r,"setPosition",i)}Object.keys(n).length>0;for(var s in n)s&&google.maps.event.addListener(r,s,n[s]);return r};return{restrict:"E",require:"^map",link:function(e,r,o,a){var i=t.orgAttributes(r),s=t.filter(o),p=t.getOptions(s,e),c=t.getEvents(e,s);r.bind("$destroy",function(){var e=l.map.markers;for(var t in e)e[t]==l&&delete e[t];l.setMap(null)});var l=n(p,c);a.addMarker(l),t.observeAttrSetObj(i,o,l)}}}]),ngMap.directive("overlayMapType",["Attr2Options","$window",function(e,t){return{restrict:"E",require:"^map",link:function(e,n,r,o){var a,i=r.initMethod||"insertAt";if(r.object){var s=e[r.object]?e:t;a=s[r.object],"function"==typeof a&&(a=new a)}if(!a)throw"invalid map-type object";e.$on("mapInitialized",function(e,t){if("insertAt"==i){var n=parseInt(r.index,10);t.overlayMapTypes.insertAt(n,a)}else"push"==i&&t.overlayMapTypes.push(a)}),o.addObject("overlayMapTypes",a)}}}]),ngMap.directive("shape",["Attr2Options",function(e){var t=e,n=function(e){return new google.maps.LatLngBounds(e[0],e[1])},r=function(e,r){var o,a=e.name;if(delete e.name,e.icons)for(var i=0;i<e.icons.length;i++){var s=e.icons[i];s.icon.path.match(/^[A-Z_]+$/)&&(s.icon.path=google.maps.SymbolPath[s.icon.path])}switch(a){case"circle":if(e.center instanceof google.maps.LatLng)o=new google.maps.Circle(e);else{var p=e.center;e.center=new google.maps.LatLng(0,0),o=new google.maps.Circle(e),t.setDelayedGeoLocation(o,"setCenter",p)}break;case"polygon":o=new google.maps.Polygon(e);break;case"polyline":o=new google.maps.Polyline(e);break;case"rectangle":e.bounds&&(e.bounds=n(e.bounds)),o=new google.maps.Rectangle(e);break;case"groundOverlay":case"image":var c=e.url,l=n(e.bounds),u={opacity:e.opacity,clickable:e.clickable,id:e.id};o=new google.maps.GroundOverlay(c,l,u)}for(var g in r)r[g]&&google.maps.event.addListener(o,g,r[g]);return o};return{restrict:"E",require:"^map",link:function(e,n,o,a){var i=t.orgAttributes(n),s=t.filter(o),p=t.getOptions(s),c=t.getEvents(e,s),l=r(p,c);a.addShape(l),t.observeAttrSetObj(i,o,l)}}}]),ngMap.directive("trafficLayer",["Attr2Options",function(e){var t=e,n=function(e,t){var n=new google.maps.TrafficLayer(e);for(var r in t)google.maps.event.addListener(n,r,t[r]);return n};return{restrict:"E",require:"^map",link:function(e,r,o,a){var i=t.orgAttributes(r),s=t.filter(o),p=t.getOptions(s),c=t.getEvents(e,s),l=n(p,c);a.addObject("trafficLayers",l),t.observeAttrSetObj(i,o,l)}}}]),ngMap.directive("transitLayer",["Attr2Options",function(e){var t=e,n=function(e,t){var n=new google.maps.TransitLayer(e);for(var r in t)google.maps.event.addListener(n,r,t[r]);return n};return{restrict:"E",require:"^map",link:function(e,r,o,a){var i=t.orgAttributes(r),s=t.filter(o),p=t.getOptions(s),c=t.getEvents(e,s),l=n(p,c);a.addObject("transitLayers",l),t.observeAttrSetObj(i,o,l)}}}]),ngMap.directive("weatherLayer",["Attr2Options",function(e){var t=e,n=function(e,t){var n=new google.maps.weather.WeatherLayer(e);for(var r in t)google.maps.event.addListener(n,r,t[r]);return n};return{restrict:"E",require:"^map",link:function(e,r,o,a){var i=t.orgAttributes(r),s=t.filter(o),p=t.getOptions(s),c=t.getEvents(e,s),l=n(p,c);a.addObject("weatherLayers",l),t.observeAttrSetObj(i,o,l)}}}]);